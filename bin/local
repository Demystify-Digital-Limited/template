#!/usr/bin/env bash
[[ ! "$PWD" =~ /var/www/html$ ]] && echo "Please run commands in the root directory." && exit
set -o errexit

read -p "Do you want to enable or disable local mode? (enable/disable): " mode
if [[ "$mode" != "enable" && "$mode" != "disable" ]]; then
	echo "Invalid option. Please choose 'enable' or 'disable'."
	exit
fi

if [[ "$mode" == "enable" ]]; then
	read -p "WARNING: Using this command in production will break SSL and domain connectivity. Are you sure you are running this site locally? (yes/no): " confirm
	if [[ "$confirm" != "yes" ]]; then
		echo "Aborting."
		exit
	fi
	bin/cliq bin/magento config:set web/secure/use_in_frontend 0
	bin/cliq bin/magento config:set web/secure/use_in_adminhtml 0
	bin/cliq bin/magento config:set web/unsecure/base_url http://localhost:3000/
	bin/cliq bin/magento config:set web/secure/base_url http://localhost:3000/
	bin/magento deploy:mode:set developer
	echo "Running bin/cmds..."
	bin/cliq bin/cmds
	echo "Local mode enabled. Magento is at: http://localhost:3000. You can run 'bin/local disable' to disable local mode."
else
	bin/cliq bin/magento config:set web/secure/use_in_frontend 1
	bin/cliq bin/magento config:set web/secure/use_in_adminhtml 1
	bin/cliq bin/magento config:set web/unsecure/base_url http://localhost:80/
	bin/cliq bin/magento config:set web/secure/base_url http://localhost:80/
	bin/magento deploy:mode:set production
	echo "Running bin/cmds..."
	bin/cliq bin/cmds
	echo "Local mode disabled. Magento is at: https://$DOMAIN"
fi

